<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Marsha Kerr Talley | Turning Pain Into Possibilities</title>
</head>

<body style="margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;">

<!-- ======================================================
     SECTION 1: SITE HEADER / NAVIGATION (UNCHANGED)
====================================================== -->
<header style="
  width:100%;
  background:#ffffff;
  border-bottom:1px solid #e6f2f2;
">
  <div style="
    max-width:1200px;
    margin:0 auto;
    padding:20px 16px 12px;
    display:flex;
    flex-direction:column;
    align-items:center;
    box-sizing:border-box;
  ">
    <!-- LOGO -->
    <a href="index.html" style="display:inline-block;">
      <img
        src="MKT-logo-3.png"
        alt="Marsha Kerr Talley ‚Äì Live Inspired"
        style="
          max-width:220px;
          width:100%;
          height:auto;
          display:block;
          margin:0 auto 12px;
        "
      />
    </a>

    <!-- NAV LINKS -->
    <nav aria-label="Main navigation">
      <ul style="
        list-style:none;
        padding:0;
        margin:0;
        display:flex;
        gap:28px;
        flex-wrap:wrap;
        justify-content:center;
        font-size:14px;
        letter-spacing:0.08em;
        text-transform:uppercase;
      ">
        <li><a href="index.html" style="color:#056367;text-decoration:none;font-weight:600;">Home</a></li>
        <li><a href="work-with-me.html" style="color:#2f2f2f;text-decoration:none;">Work With Me</a></li>
        <li><a href="books.html" style="color:#2f2f2f;text-decoration:none;">Books</a></li>
        <li><a href="podcast.html" style="color:#2f2f2f;text-decoration:none;">Podcast</a></li>
        <li><a href="reflections.html" style="color:#2f2f2f;text-decoration:none;">Reflections</a></li>
      </ul>
    </nav>
  </div>
</header>

<!-- ======================================================
     SECTION 2: LIVE INSPIRED COMMUNITY + FIREBASE SDKs (UNCHANGED)
====================================================== -->
<!-- LIVE INSPIRED COMMUNITY | FINAL ARCHIVED BUILD (NO UI EDIT/DELETE; FIREBASE-ONLY DELETES)
     Archived: 2025-12-19
     Admin deletes handled in Firebase Console (Firestore) only.
-->

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>

<!-- ======================================================
     SECTION 3: COMMUNITY UI + STYLES + YOUTUBE CARD (UNCHANGED)
====================================================== -->
<section id="admin-upload">
<style>
#admin-upload, #admin-upload * { box-sizing:border-box; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif }
#admin-upload { min-height:100vh; padding:56px 24px; background:linear-gradient(180deg,#f6fefe,#ffffff) }
.wrap { max-width:900px; margin:0 auto; display:grid; gap:32px }
h1 { text-align:center; color:#056367; font-size:44px; font-weight:900 }
p.sub { text-align:center; color:#0d4b4e }

.card,.post { background:#fff; border:3px solid #2fe2dd; border-radius:26px; padding:24px; display:grid; gap:16px; box-shadow:0 20px 60px rgba(0,0,0,.08) }

/* ‚úÖ NEW: YouTube section (matches your card style) */
.youtube-section h2{
  text-align:center;
  color:#056367;
  margin:0;
  font-size:26px;
  font-weight:900;
}
.youtube-grid{
  display:grid;
  gap:18px;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  align-items:stretch;
}
.yt-embed{
  width:100%;
  aspect-ratio:16/9;
  border-radius:18px;
  overflow:hidden;
  background:#000;
}
.yt-embed iframe{
  width:100%;
  height:100%;
  border:0;
}

.admin-link { text-align:right; font-size:14px; color:#056367; cursor:pointer; text-decoration:underline }
#adminLoginBox { display:none }
#adminIndicator { text-align:center; font-size:14px; font-weight:800; color:#056367; display:none }

textarea.post-message { min-height:180px; font-size:17px; line-height:1.6; resize:vertical }
input,textarea { width:100%; padding:14px; border-radius:14px; border:1px solid #ccc }

.publish-wrap { display:flex; justify-content:center }
button { background:linear-gradient(135deg,#056367,#319fa2); color:#fff; border:none; padding:10px 22px; border-radius:999px; font-weight:800; cursor:pointer }

.remove-media-link { font-size:13px; color:#056367; text-decoration:underline; cursor:pointer; width:fit-content }

.post-topbar { display:flex; justify-content:space-between; align-items:flex-start; gap:12px }
.post-date { font-size:13px; color:#0d4b4e }
.admin-mini a,.comment-mini a { font-size:13px; color:#056367; text-decoration:underline; cursor:pointer; margin-left:10px }

.reactions { display:flex; gap:10px; flex-wrap:wrap }
.reactions button { background:#f0fefe; color:#056367; border:1px solid #2fe2dd; padding:6px 14px; font-weight:800 }

textarea.comment-box { min-height:80px; white-space:pre-wrap }
.comment-actions { display:flex; justify-content:flex-end }
.comment-submit { margin-top:6px; padding:6px 16px; font-size:14px }

.comment { border-top:1px solid #e0f7f7; padding-top:10px; white-space:pre-wrap; display:grid; gap:6px }
.comment-head { display:flex; justify-content:space-between; align-items:center; gap:10px }
.comment-badge { font-size:12px; font-weight:800; color:#056367; border:1px solid #2fe2dd; background:#f0fefe; padding:2px 10px; border-radius:999px }

.media img,.media video { width:100%; border-radius:16px }
.media-vertical { max-width:360px; margin:0 auto; aspect-ratio:9/16 }
.media-wide { width:100%; aspect-ratio:16/9 }
.media-vertical iframe,.media-wide iframe { width:100%; height:100%; border-radius:16px }

#preview { max-height:360px; overflow-y:auto }
#preview img,#preview video { max-height:340px; object-fit:contain }

/* ‚úÖ NEW: visible error box if Firestore fails */
.error-box{
  border:2px solid #ffb3b3;
  background:#fff5f5;
  color:#7a1f1f;
  padding:14px 16px;
  border-radius:16px;
  font-size:14px;
  line-height:1.5;
}
</style>

<div class="wrap">
  <h1>Live Inspired Community</h1>
  <p class="sub">Encouragement, reflection, and shared growth.</p>

  <!-- ‚úÖ YouTube section inserted above admin/feed (UNCHANGED) -->
  <div class="card youtube-section">
    <h2>From YouTube ¬∑ Watch & Reflect</h2>
    <p class="sub">Moments of insight, encouragement, and conversation.</p>

    <div id="youtubeGrid" class="youtube-grid"></div>
  </div>

  <div id="adminIndicator">Admin logged in</div>
  <div class="admin-link" onclick="toggleAdminLogin()">Admin login</div>

  <div class="card" id="adminLoginBox">
    <input id="adminEmail" type="email" placeholder="Admin email">
    <input id="adminPassword" type="password" placeholder="Admin password">
    <button onclick="adminLogin()">Sign in</button>
    <div id="loginStatus"></div>
  </div>

  <!-- ADMIN ONLY COMPOSER (hidden from public) -->
  <div class="card" id="composer" style="display:none">
    <textarea id="postText" class="post-message" placeholder="Write your message‚Ä¶"></textarea>
    <input id="mediaUrl" placeholder="Optional media URL (image, video, or YouTube)">
    <input id="fileInput" type="file" accept="image/*,video/*">
    <span class="remove-media-link" onclick="clearMedia()">Remove media</span>
    <div id="preview"></div>
    <div class="publish-wrap">
      <button onclick="publishPost()">Publish Post</button>
    </div>
  </div>

  <div id="feed"></div>
</div>
</section>

<!-- ======================================================
     SECTION 4: FIREBASE COMMUNITY LOGIC (UNCHANGED)
====================================================== -->
<script>
firebase.initializeApp({
  apiKey:"AIzaSyBZCg70hhCkx01ccZWePeIKAZEPC3mejkc",
  authDomain:"testimonials-8100a.firebaseapp.com",
  projectId:"testimonials-8100a",
  storageBucket:"testimonials-8100a.appspot.com"
});

const db=firebase.firestore();
const storage=firebase.storage();
const auth=firebase.auth();

const ADMIN_UID="Pv7XvFLXa8Xh1j0EMpiKoG2dIyX2";
const REACTION_ORDER=["‚ù§Ô∏è","üôè","üòÇ","üòÆ","üò¢","üî•"];
let isAdmin=false, postsCache=[], commentUnsubs={};

/* ‚úÖ Explicit DOM refs (Safari-safe) */
const adminIndicator = document.getElementById("adminIndicator");
const adminLoginBox  = document.getElementById("adminLoginBox");
const composer       = document.getElementById("composer");
const feed           = document.getElementById("feed");
const adminEmail     = document.getElementById("adminEmail");
const adminPassword  = document.getElementById("adminPassword");
const loginStatus    = document.getElementById("loginStatus");
const postText       = document.getElementById("postText");
const mediaUrl       = document.getElementById("mediaUrl");
const fileInput      = document.getElementById("fileInput");
const preview        = document.getElementById("preview");

function esc(s){return String(s||"").replace(/[&<>"']/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;" }[m]))}
function escBreaks(s){return esc(s).replace(/\n/g,"<br>")}

(async()=>{try{await auth.setPersistence(firebase.auth.Auth.Persistence.LOCAL)}catch{}})();

auth.onAuthStateChanged(u=>{
  isAdmin=!!(u&&u.uid===ADMIN_UID);

  adminIndicator.style.display=isAdmin?"block":"none";
  adminIndicator.innerHTML=isAdmin
    ? `Admin logged in<br><span style="font-weight:700; font-size:12px; color:#0d4b4e;">Note: Deletes are handled in Firebase Console (Firestore) only.</span>`
    : "Admin logged in";

  composer.style.display=isAdmin?"grid":"none";
  if(isAdmin) adminLoginBox.style.display="none";
  renderFeed();
});

function toggleAdminLogin(){
  adminLoginBox.style.display = (adminLoginBox.style.display==="grid") ? "none" : "grid";
}
async function adminLogin(){
  try{
    await auth.signInWithEmailAndPassword(adminEmail.value,adminPassword.value);
    loginStatus.innerText="Admin logged in";
    adminLoginBox.style.display="none";
  }catch(e){
    loginStatus.innerText=e.message;
  }
}

function parseYouTube(u){
  u = String(u||"");
  if(u.includes("/shorts/"))return{id:u.split("/shorts/")[1].split(/[?&]/)[0],short:true};
  if(u.includes("watch?v="))return{id:u.split("watch?v=")[1].split("&")[0],short:false};
  if(u.includes("youtu.be/"))return{id:u.split("youtu.be/")[1].split(/[?&]/)[0],short:false};
  return{id:"",short:false};
}

/* Media preview */
mediaUrl.oninput=()=>{
  if(fileInput.files[0])return;
  preview.innerHTML="";
  const yt=parseYouTube(mediaUrl.value.trim());
  if(yt.id){
    preview.innerHTML=yt.short
      ? `<div class="media-vertical"><iframe src="https://www.youtube.com/embed/${yt.id}" allowfullscreen></iframe></div>`
      : `<div class="media-wide"><iframe src="https://www.youtube.com/embed/${yt.id}" allowfullscreen></iframe></div>`;
  }
};

fileInput.addEventListener("change",()=>{
  preview.innerHTML="";
  const f=fileInput.files[0];
  if(!f)return;
  const blob=URL.createObjectURL(f);
  preview.innerHTML=f.type.startsWith("video")
    ? `<video controls src="${blob}"></video>`
    : `<img src="${blob}">`;
  mediaUrl.value="";
});

function clearMedia(){
  mediaUrl.value="";
  fileInput.value="";
  preview.innerHTML="";
}

async function publishPost(){
  if(!isAdmin)return alert("Admin only");
  let media="",type="",ytShort=false;

  if(fileInput.files[0]){
    const f=fileInput.files[0];
    const ref=storage.ref("community_uploads/"+Date.now()+"_"+f.name);
    await ref.put(f,{contentType:f.type});
    media=await ref.getDownloadURL();
    type=f.type.startsWith("video")?"video":"image";
  }else if(mediaUrl.value.trim()){
    const yt=parseYouTube(mediaUrl.value.trim());
    media=mediaUrl.value.trim();
    if(yt.id){type="youtube";ytShort=yt.short}
    else type="image";
  }

  await db.collection("posts").add({
    text:postText.value,
    media,type,ytShort,
    reactions:{ "‚ù§Ô∏è":0,"üôè":0,"üòÇ":0,"üòÆ":0,"üò¢":0,"üî•":0 },
    reactionUsers:{},
    createdAt:firebase.firestore.FieldValue.serverTimestamp()
  });

  postText.value="";
  clearMedia();
}

/* ‚úÖ Snapshot with visible error reporting */
db.collection("posts").orderBy("createdAt","desc").onSnapshot(
  s=>{
    postsCache=s.docs;
    renderFeed();
  },
  err=>{
    feed.innerHTML = `
      <div class="error-box">
        <strong>Your Community feed didn‚Äôt load.</strong><br>
        Firebase error: <code>${esc(err.message || err)}</code><br><br>
        Most common causes:<br>
        ‚Ä¢ Firestore security rules blocking reads<br>
        ‚Ä¢ Wrong projectId / rules changed<br>
        ‚Ä¢ Network/ad-blocker blocking Firebase<br>
      </div>
    `;
  }
);

function renderFeed(){
  feed.innerHTML="";
  postsCache.forEach(doc=>{
    const p=doc.data();
    const date=p.createdAt?.toDate().toLocaleString()||"";

    const reactions=REACTION_ORDER.map(r=>
      `<button data-act="react" data-id="${doc.id}" data-emo="${r}">${r} ${(p.reactions||{})[r]||0}</button>`
    ).join("");

    feed.innerHTML+=`
      <div class="post">
        <div class="post-topbar">
          <div class="post-date">${date}</div>
        </div>
        <div>${escBreaks(p.text)}</div>

        <div class="media">
          ${p.type==="image"?`<img src="${esc(p.media)}">`:""}
          ${p.type==="video"?`<video controls src="${esc(p.media)}"></video>`:""}
          ${p.type==="youtube"?(
            p.ytShort
              ? `<div class="media-vertical"><iframe src="https://www.youtube.com/embed/${parseYouTube(p.media).id}" allowfullscreen></iframe></div>`
              : `<div class="media-wide"><iframe src="https://www.youtube.com/embed/${parseYouTube(p.media).id}" allowfullscreen></iframe></div>`
          ):""}
        </div>

        <div class="reactions">${reactions}</div>

        <div id="comments-${doc.id}"></div>
        <textarea class="comment-box" placeholder="Write a comment‚Ä¶"></textarea>
        <div class="comment-actions">
          <button class="comment-submit" data-act="comment" data-id="${doc.id}">Post comment</button>
        </div>
      </div>`;

    if(!commentUnsubs[doc.id]){
      commentUnsubs[doc.id]=db.collection("posts").doc(doc.id)
        .collection("comments").orderBy("createdAt","asc")
        .onSnapshot(cs=>{
          const box=document.getElementById("comments-"+doc.id);
          if(!box)return;
          box.innerHTML="";
          cs.forEach(c=>{
            const cd=c.data();
            box.innerHTML+=`
              <div class="comment">
                <div class="comment-head">
                  ${cd.isAdmin?`<span class="comment-badge">Marsha</span>`:""}
                </div>
                <div>${escBreaks(cd.text)}</div>
              </div>`;
          });
        });
    }
  });
}

/* Keep delegated handler ONLY for comment posting (working behavior preserved) */
feed.addEventListener("click",async e=>{
  const t=e.target;
  if(!t.dataset.act)return;

  if(t.dataset.act==="comment"){
    const box=t.closest(".post").querySelector(".comment-box");
    if(!box.value.trim())return;
    await db.collection("posts").doc(t.dataset.id).collection("comments")
      .add({text:box.value,isAdmin,createdAt:firebase.firestore.FieldValue.serverTimestamp()});
    box.value="";
  }

  /* Reactions were present in your original build but had no handler; left unchanged. */
});
</script>

 <!-- ======================================================
     SECTION: MIDDLE GROUND VIDEO
====================================================== -->
  <section style="
  max-width: 1000px;
  margin: 4rem auto 3rem;
  padding: 2.5rem 1.5rem;
  border-top: 1px solid rgba(5, 99, 103, 0.2);
  font-family: inherit;
">

  <h2 style="
    color: #056367;
    font-size: 1.8rem;
    font-weight: 500;
    margin-bottom: 1rem;
  ">
    In Conversation: Questioning, Identity &amp; Human Experience
  </h2>

  <p style="
    font-size: 1rem;
    line-height: 1.7;
    color: #1a1f22;
    max-width: 780px;
    margin-bottom: 1rem;
  ">
    I took part in Jubilee‚Äôs <em>Middle Ground</em> to explore questions around identity, attraction,
    and self-understanding ‚Äî not to reach a conclusion, but to sit with nuance.
  </p>

  <p style="
    font-size: 1rem;
    line-height: 1.7;
    color: #1a1f22;
    max-width: 780px;
    margin-bottom: 1rem;
  ">
    This conversation reflects my belief that not every human experience needs a label,
    and that clarity often emerges through honest dialogue rather than certainty.
  </p>

  <p style="
    font-size: 1rem;
    line-height: 1.7;
    color: #1a1f22;
    max-width: 780px;
    margin-bottom: 2rem;
  ">
    If you‚Äôre someone who values reflection, curiosity, and respectful conversation across difference,
    you may find this meaningful.
  </p>

  <div style="
    max-width: 780px;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 10px 30px rgba(0,0,0,0.15);
  ">
    <iframe
      width="100%"
      height="440"
      src="https://www.youtube.com/embed/RyxtZnWCUSM"
      title="Middle Ground ‚Äì Questioning, Identity & Human Experience"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
      allowfullscreen>
    </iframe>
  </div>

</section>

<!-- ======================================================
     SECTION 5: SITE FOOTER (UNCHANGED)
====================================================== -->
<footer class="site-footer">
  <div class="footer-inner">

    <p class="copyright">
      Copyright ¬© <span id="currentYear"></span> Marsha Kerr Talley ‚Äî All Rights Reserved.
    </p>

    <nav class="footer-links">
      <a href="/privacy-policy">Privacy Policy</a>
      <a href="/shipping-return-policy">Shipping &amp; Return Policy</a>
      <a href="/terms-and-conditions">Terms and Conditions</a>
    </nav>

  </div>
</footer>

<!-- ======================================================
     SECTION 6: ‚úÖ YOUTUBE PLAYLIST AUTO-PULL (FIXED ONLY)
     - You MUST paste your full API key (no asterisks)
     - Added origin param
     - Shows the real Google error message on screen for debugging
====================================================== -->
<script>
/* =========================
   YOUTUBE PLAYLIST AUTO-PULL
   ========================= */

// ‚úÖ FIX 1: You MUST use the full key (no ********). A masked key will ALWAYS fail.
const YT_API_KEY = "AIzaSyC3xNazHu8AxyHooaTqOWkAudnVaNLJ5yU";
const PLAYLIST_ID = "PLfLwFGreLvJGFe9llGE1qj-0zx8sOWZui";
const MAX_RESULTS = 6;

async function loadYouTubePlaylist() {
  const grid = document.getElementById("youtubeGrid");
  if (!grid) return;

  // Optional: show a simple loading message (uses your existing styling)
  grid.innerHTML = `<div class="error-box"><strong>Loading videos‚Ä¶</strong></div>`;

  try {
    const origin = encodeURIComponent(window.location.origin);

    const url =
      `https://www.googleapis.com/youtube/v3/playlistItems` +
      `?part=snippet` +
      `&playlistId=${encodeURIComponent(PLAYLIST_ID)}` +
      `&maxResults=${encodeURIComponent(MAX_RESULTS)}` +
      `&key=${encodeURIComponent(YT_API_KEY)}` +
      `&origin=${origin}`;

    const response = await fetch(url);
    const data = await response.json();

    // ‚úÖ FIX 2: Show real error details if Google returns an error
    if (!response.ok || !data.items) {
      const msg =
        (data && data.error && data.error.message) ? data.error.message :
        "Unknown YouTube API error. Check console for details.";

      grid.innerHTML = `
        <div class="error-box">
          <strong>Unable to load YouTube videos.</strong><br>
          ${msg}<br><br>
          <strong>Most common fixes:</strong><br>
          ‚Ä¢ Google Cloud ‚Üí API key ‚Üí Website restrictions must include:<br>
          <code>https://marshakerrtalley-star.github.io/*</code><br>
          <code>https://marshakerrtalley.com/*</code><br>
          ‚Ä¢ Ensure YouTube Data API v3 is enabled<br>
          ‚Ä¢ Ensure this playlist is Public or Unlisted
        </div>
      `;
      console.error("YouTube API error payload:", data);
      return;
    }

    grid.innerHTML = "";

    data.items.forEach(item => {
      const videoId = item.snippet?.resourceId?.videoId;
      if (!videoId) return;

      grid.innerHTML += `
        <div class="yt-embed">
          <iframe
            src="https://www.youtube-nocookie.com/embed/${videoId}"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen>
          </iframe>
        </div>
      `;
    });

  } catch (err) {
    grid.innerHTML = `
      <div class="error-box">
        <strong>Unable to load YouTube videos.</strong><br>
        Network/browser blocked the request (ad-blocker, privacy setting, or offline).<br><br>
        Check console for details.
      </div>
    `;
    console.error("YouTube fetch failed:", err);
  }
}

loadYouTubePlaylist();
</script>


  
<!-- ======================================================
     SECTION 7: FOOTER STYLES (UNCHANGED)
====================================================== -->
<style>
.site-footer {
  background-color: #ffffff;
  border-top: 1px solid #eee;
  padding: 2.5rem 1.5rem 2rem;
  text-align: center;
  font-family: inherit;
}

.footer-inner {
  max-width: 1200px;
  margin: 0 auto;
}

.site-footer p {
  margin: 0 0 1.4rem;
  font-size: 0.95rem;
  color: #666;
}

.footer-links {
  display: flex;
  justify-content: center;
  gap: 2rem;
  flex-wrap: wrap;
}

.footer-links a {
  font-size: 1rem;
  color: #319fa2;
  text-decoration: none;
  transition: color 0.3s ease;
}

.footer-links a:hover {
  color: #056367;
  text-decoration: underline;
}
</style>

<!-- ======================================================
     SECTION 8: AUTO-UPDATE COPYRIGHT YEAR (UNCHANGED)
====================================================== -->
<script>
  document.getElementById("currentYear").textContent =
    new Date().getFullYear();
</script>

</body>
</html>
